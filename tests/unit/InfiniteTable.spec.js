import { mount } from '@vue/test-utils'
import InfiniteTable from '@/packages/infinite-table/src/index.vue'

describe('InfiniteTable.vue', () => {
  it('shonld render infinite-table class', () => {
    const wrapper = mount(InfiniteTable)
    expect(wrapper.attributes().class).toMatch('infinite-table')
  })
  
  it('shonld setData after infinite-table in BasicUsage', async () => {
    const wrapper = mount(InfiniteTable)
    const tableData = {
      data: [
        {
          query: {
            jumpCode: null,
            jumpValue: null
          },
          key: '0000-0000-0000-0000',
          '2585-2314-2501-0000': '可乐',
          '2585-2314-2501-0001': '0.01',
          '2585-2314-2501-0002': '0.02',
          '2585-2314-2501-0003': '0.03',
          children: [
            {
              '2585-2314-2501-0000': '无糖可乐1号',
              '2585-2314-2501-0001': '0.11',
              '2585-2314-2501-0002': '0.12',
              '2585-2314-2501-0003': '0.13',
              pKey: '0000-0000-0000-0000',
              key: '0000-0001-0000-0000'
            },
            {
              '2585-2314-2501-0000': '无糖可乐2号',
              '2585-2314-2501-0001': '0.11',
              '2585-2314-2501-0002': '0.12',
              '2585-2314-2501-0003': '0.13',
              pKey: '0000-0000-0000-0000',
              key: '0000-0002-0000-0000'
            },
            {
              '2585-2314-2501-0000': '无糖可乐号这里是二级纯中文字符凑字数用来校验数据超长问题',
              '2585-2314-2501-0001': '0.11',
              '2585-2314-2501-0002': '0.12',
              '2585-2314-2501-0003': '0.13',
              pKey: '0000-0000-0000-0000',
              key: '0000-0003-0000-0000'
            },
            {
              '2585-2314-2501-0000': '无糖可乐4号ThisIsTheOthersMakeUpTheWordCountIInLevel2',
              '2585-2314-2501-0001': '0.11',
              '2585-2314-2501-0002': '0.12',
              '2585-2314-2501-0003': '0.13',
              pKey: '0000-0000-0000-0000',
              key: '0000-0004-0000-0000'
            },
            {
              '2585-2314-2501-0000': '无糖可乐5号',
              '2585-2314-2501-0001': '0.11',
              '2585-2314-2501-0002': '0.12',
              '2585-2314-2501-0003': '0.13',
              pKey: '0000-0000-0000-0000',
              key: '0000-0005-0000-0000'
            },
            {
              '2585-2314-2501-0000': '无糖可乐6号',
              '2585-2314-2501-0001': '0.11',
              '2585-2314-2501-0002': '0.12',
              '2585-2314-2501-0003': '0.13',
              pKey: '0000-0000-0000-0000',
              key: '0000-0006-0000-0000'
            },
            {
              '2585-2314-2501-0000': '无糖可乐7号',
              '2585-2314-2501-0001': '0.11',
              '2585-2314-2501-0002': '0.12',
              '2585-2314-2501-0003': '0.13',
              pKey: '0000-0000-0000-0000',
              key: '0000-0007-0000-0000'
            },
            {
              '2585-2314-2501-0000': '无糖可乐8号',
              '2585-2314-2501-0001': '0.11',
              '2585-2314-2501-0002': '0.12',
              '2585-2314-2501-0003': '0.13',
              pKey: '0000-0000-0000-0000',
              key: '0000-0008-0000-0000'
            },
            {
              '2585-2314-2501-0000': '无糖可乐9号',
              '2585-2314-2501-0001': '0.11',
              '2585-2314-2501-0002': '0.12',
              '2585-2314-2501-0003': '0.13',
              pKey: '0000-0000-0000-0000',
              key: '0000-0009-0000-0000'
            },
            {
              '2585-2314-2501-0000': '无糖可乐10号',
              '2585-2314-2501-0001': '0.11',
              '2585-2314-2501-0002': '0.12',
              '2585-2314-2501-0003': '0.13',
              pKey: '0000-0000-0000-0000',
              key: '0000-0010-0000-0000'
            },
            {
              '2585-2314-2501-0000': '无糖可乐11号',
              '2585-2314-2501-0001': '0.11',
              '2585-2314-2501-0002': '0.12',
              '2585-2314-2501-0003': '0.13',
              pKey: '0000-0000-0000-0000',
              key: '0000-0011-0000-0000'
            },
            {
              '2585-2314-2501-0000': '无糖可乐12号',
              '2585-2314-2501-0001': '0.11',
              '2585-2314-2501-0002': '0.12',
              '2585-2314-2501-0003': '0.13',
              pKey: '0000-0000-0000-0000',
              key: '0000-0012-0000-0000'
            },
            {
              '2585-2314-2501-0000': '无糖可乐13号',
              '2585-2314-2501-0001': '0.11',
              '2585-2314-2501-0002': '0.12',
              '2585-2314-2501-0003': '0.13',
              pKey: '0000-0000-0000-0000',
              key: '0000-0013-0000-0000'
            },
            {
              '2585-2314-2501-0000': '无糖可乐14号',
              '2585-2314-2501-0001': '0.11',
              '2585-2314-2501-0002': '0.12',
              '2585-2314-2501-0003': '0.13',
              pKey: '0000-0000-0000-0000',
              key: '0000-0014-0000-0000'
            },
            {
              '2585-2314-2501-0000': '无糖可乐15号',
              '2585-2314-2501-0001': '0.11',
              '2585-2314-2501-0002': '0.12',
              '2585-2314-2501-0003': '0.13',
              pKey: '0000-0000-0000-0000',
              key: '0000-0015-0000-0000'
            },
            {
              '2585-2314-2501-0000': '无糖可乐16号',
              '2585-2314-2501-0001': '0.11',
              '2585-2314-2501-0002': '0.12',
              '2585-2314-2501-0003': '0.13',
              pKey: '0000-0000-0000-0000',
              key: '0000-0016-0000-0000'
            }
          ]
        },
        {
          query: {
            jumpCode: null,
            jumpValue: null
          },
          key: '0001-0000-0000-0000',
          '2585-2314-2501-0000': '无百事不可乐的百事可乐',
          '2585-2314-2501-0001': '1.01',
          '2585-2314-2501-0002': '1.02',
          '2585-2314-2501-0003': '1.03',
          children: [
            {
              '2585-2314-2501-0000': '百事无糖1号',
              '2585-2314-2501-0001': '1.11',
              '2585-2314-2501-0002': '1.12',
              '2585-2314-2501-0003': '1.13',
              pKey: '0001-0000-0000-0000',
              key: '0001-0001-0000-0000'
            },
            {
              '2585-2314-2501-0000': '百事无糖2号',
              '2585-2314-2501-0001': '1.11',
              '2585-2314-2501-0002': '1.12',
              '2585-2314-2501-0003': '1.13',
              pKey: '0001-0000-0000-0000',
              key: '0001-0002-0000-0000'
            }
          ]
        },
        {
          query: {
            jumpCode: null,
            jumpValue: null
          },
          key: '0002-0000-0000-0000',
          // '2585-2314-2501-0000': '可乐junThisIsTheFirstLevelAndrequiresALotOfCharacters',
          '2585-2314-2501-0000': '可乐junThisIsThe',
          '2585-2314-2501-0001': '0.01',
          '2585-2314-2501-0002': '0.02',
          '2585-2314-2501-0003': '0.03',
          children: [
            {
              '2585-2314-2501-0000': '无糖可乐1号',
              '2585-2314-2501-0001': '0.11',
              '2585-2314-2501-0002': '0.12',
              '2585-2314-2501-0003': '0.13',
              pKey: '0002-0000-0000-0000',
              key: '0002-0001-0000-0000'
            },
            {
              '2585-2314-2501-0000': '无糖可乐2号',
              '2585-2314-2501-0001': '0.11',
              '2585-2314-2501-0002': '0.12',
              '2585-2314-2501-0003': '0.13',
              pKey: '0002-0000-0000-0000',
              key: '0002-0002-0000-0000'
            }
          ]
        }
      ],
      columns: [
        {
          fixed: true,
          isSort: false,
          key: '2585-2314-2501-0000',
          name: '产品名称',
          sort: '0',
          style: {},
          unit: ''
        },
        {
          fixed: false,
          isSort: true,
          key: '2585-2314-2501-0001',
          name: '当年收入',
          sort: '1',
          style: {},
          unit: '亿'
        },
        {
          fixed: false,
          isSort: true,
          key: '2585-2314-2501-0002',
          name: '当月收入',
          sort: '0',
          style: {},
          unit: '亿'
        },
        {
          fixed: false,
          isSort: true,
          key: '2585-2314-2501-0003',
          name: '当日收入',
          sort: '0',
          style: {},
          unit: '亿'
        }
      ]
    }
    
    await wrapper.setProps({ tableData })
    // 父级表格是否出现
    const CardContainerTable = wrapper.findComponent({ name: 'CardContainerTable' })
    expect(CardContainerTable.exists()).toBe(true)
    const CardFixedTable = wrapper.findComponent({ name: 'CardFixedTable' })
    expect(CardFixedTable.exists()).toBe(true)
    const CardHeaderTable = wrapper.findComponent({ name: 'CardHeaderTable' })
    expect(CardHeaderTable.exists()).toBe(true)
    // 点击可乐
    const e = await wrapper.find('.infinite-table-fixed-div').findAll('.infinite-p-tr').at(2).findAll('.infinite-p-td').at(1)
    expect(e.exists()).toBe(true)
    await e.trigger('click')
    expect(e.attributes().class).toMatch('infinite-unit-clicked')
    // 点击查看更多
    const f = await wrapper.find('.infinite-table-fixed-div')
      .findAll('.infinite-tr-children').at(1)
      .find('.infinite-table-fixed-c-more-btn')
    expect(f.exists()).toBe(true)
    await f.trigger('click')
    // 校验弹窗
    const g = await wrapper.find('.infinite-table-picker-popuper').find('.infinite-table')
    expect(g.exists()).toBe(true)
  })
})
